(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-061e7a88"],{"63e9":function(t,i,e){"use strict";e.r(i);var a=function(){var t=this,i=t._self._c;return i("div",{staticClass:"upload-head"},[i("el-upload",{staticClass:"upload-image",attrs:{action:"/","single-file":"",accept:"image/jpeg, image/png, image/bmp",multiple:!1,"show-file-list":!1,"auto-upload":!1,"on-change":t.onChange}},[i("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("选取文件")])],1),i("div",{staticClass:"view-img"},[i("el-image",{attrs:{src:t.base64}},[i("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[i("i",{staticClass:"el-icon-picture-outline"})])])],1),i("div",{staticClass:"download-section"},[i("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.downloadClippedImage}},[i("i",{staticClass:"el-icon-download"}),t._v(" 下载截取图片 ")])],1),i("el-dialog",{attrs:{title:"图像截取",width:"830px",visible:t.dialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(i){t.dialogVisible=i},close:t.handleClose}},[i("div",{staticStyle:{display:"flex",gap:"30px","justify-content":"center"}},[i("div",{staticClass:"backImg",style:{height:t.backHeight+"px",width:t.backWidth+"px",backgroundImage:""+t.url,backgroundSize:t.backgroundSize,backgroundPosition:`${t.backPosX}px ${t.backPosY}px`},on:{mousedown:t.startDrag,mouseup:t.stopDrag}},[i("div",{class:["clipMask",t.cropMode],style:{height:t.cutBoxHeight+"px",width:t.cutBoxWidth+"px",top:t.marginY+"px",left:t.marginX+"px"},on:{wheel:function(i){return i.preventDefault(),t.handleWheel.apply(null,arguments)}}},[i("canvas",{ref:"shapeCanvas",staticClass:"shapeCanvas"}),i("div",{ref:"cutBox",staticClass:"cutBox",style:{width:t.cutBoxWidth-t.shapMarge[1]-t.shapMarge[3]+"px",height:t.cutBoxHeight-t.shapMarge[0]-t.shapMarge[2]+"px",margin:`${t.shapMarge[0]}px ${t.shapMarge[1]}px ${t.shapMarge[2]}px ${t.shapMarge[3]}px`}})])]),i("div",{staticClass:"zoomSet",staticStyle:{height:"360px"}},[i("p",[t._v("缩放")]),i("p",[t._v("倍率")]),i("p",[t._v(t._s(t.zoomRatio))]),i("el-button",{directives:[{name:"repeat-click",rawName:"v-repeat-click",value:t.zoomRatioAdd,expression:"zoomRatioAdd"}],staticClass:"rsbtn",attrs:{icon:"el-icon-zoom-in",size:"mini"}}),i("el-slider",{attrs:{vertical:"",min:1,max:5,step:.01,height:"200px"},model:{value:t.zoomRatio,callback:function(i){t.zoomRatio=i},expression:"zoomRatio"}}),i("el-button",{directives:[{name:"repeat-click",rawName:"v-repeat-click",value:t.zoomRatioDec,expression:"zoomRatioDec"}],staticClass:"rsbtn",attrs:{icon:"el-icon-zoom-out",size:"mini"}})],1)]),i("br"),i("el-radio-group",{on:{input:t.changeCropMode},model:{value:t.cropMode,callback:function(i){t.cropMode=i},expression:"cropMode"}},t._l(t.shapeMap,(function(e,a){return i("el-radio-button",{key:a,attrs:{label:a}},[t._v(t._s(e))])})),1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(i){return t.clipImg()}}},[t._v("裁 剪")]),i("el-button",{on:{click:function(i){t.dialogVisible=!1}}},[t._v("关 闭")])],1)],1)],1)},s=[],o={name:"UploadHead",data(){return{radius:180,marginY:0,dialogVisible:!1,url:"",img:new Image,backgroundSize:"",imgHeight:0,imgWidth:0,backPosX:0,backPosY:0,clickX:0,clickY:0,zoomRatio:0,base64:"",cropMode:null,shapMarge:[0,0,0,0],shapeMap:{rect:"矩形",circle:"圆形",triangle:"三角形",star:"五角星",heart:"心形",hexagon:"六边形",starOfDavid:"六芒星"}}},directives:{RepeatClick:{bind(t,i,e){let a,s=null;const o=e.context[i.expression].bind(),h=()=>{new Date-a<100&&o(),clearInterval(s),s=null};t.addEventListener("mousedown",t=>{0===t.button&&(a=new Date,document.addEventListener("mouseup",h,{once:!0}),clearInterval(s),s=setInterval(o,100))})}}},computed:{cutBoxHeight(){return 2*this.radius},cutBoxWidth(){return 2*this.radius},backHeight(){return 2*this.radius},backWidth(){return 32*this.radius/9},marginX(){return 7*this.radius/9},limitX(){return this.marginX+this.cutBoxWidth-this.imgWidth*this.zoomRatio-this.shapMarge[1]},limitY(){return this.marginY+this.cutBoxHeight-this.imgHeight*this.zoomRatio-this.shapMarge[2]}},watch:{zoomRatio(){this.zooming()}},mounted(){},methods:{onChange(t,i){const e=new FileReader;e.onload=t=>{const i=t.target.result;this.url=`url(${i})`,this.getImageSize(i)},e.readAsDataURL(t.raw),i.shift()},getImageSize(t){this.img.src=t,this.img.onload=()=>{this.dialogVisible=!0,this.$nextTick(()=>{this.changeCropMode("circle")});let t=this.img.width,i=this.img.height;t>i?(t=this.cutBoxHeight*t/i,i=this.cutBoxHeight,this.backgroundSize=`auto ${this.cutBoxHeight}px`):(i=i*this.cutBoxWidth/t,t=this.cutBoxWidth,this.backgroundSize=this.cutBoxWidth+"px"),this.backPosY=(this.backHeight-i)/2,this.backPosX=(this.backWidth-t)/2,this.imgHeight=i,this.imgWidth=t}},startDrag(t){t.preventDefault(),this.clickX=t.pageX,this.clickY=t.pageY,document.addEventListener("mousemove",this.dragPic),document.addEventListener("mouseup",this.stopDrag)},stopDrag(){document.removeEventListener("mousemove",this.dragPic),document.removeEventListener("mouseup",this.stopDrag)},dragPic(t){let i=t.pageX-this.clickX,e=t.pageY-this.clickY;this.clickX=t.pageX,this.clickY=t.pageY,this.handleMoveX(i),this.handleMoveY(e)},handleMoveX(t){this.backPosX+t>this.marginX+this.shapMarge[3]?this.backPosX=this.marginX+this.shapMarge[3]:this.backPosX+t<this.limitX?this.backPosX=this.limitX:this.backPosX+=t},handleMoveY(t){this.backPosY+t>this.marginY+this.shapMarge[0]?this.backPosY=this.marginY+this.shapMarge[0]:this.backPosY+t<this.limitY?this.backPosY=this.limitY:this.backPosY+=t},handleWheel(t){t.preventDefault();const i=t.deltaY>0?-.1:.1;this.zoomRatio=Math.max(1,Math.min(5,this.zoomRatio+i)),this.zoomRatio=Number(this.zoomRatio.toFixed(2))},drawShapePath(){const t=this.$refs.shapeCanvas;if(!t)return;t.width=this.cutBoxWidth,t.height=this.cutBoxHeight;const i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),i.fillStyle="rgba(0, 0, 0, 0.4)",i.fillRect(0,0,t.width,t.height),i.save(),i.beginPath(),"rect"===this.cropMode?this.generateRectPath(this.radius,i):"circle"===this.cropMode?this.generateCirclePath(this.radius,i):"triangle"===this.cropMode?this.generateTrianglePath(this.radius,i):"star"===this.cropMode?this.generatePentagramPath(this.radius,i):"heart"===this.cropMode?this.generateHeartPath(this.radius,i):"hexagon"===this.cropMode?this.generateHexagonPath(this.radius,i):"starOfDavid"===this.cropMode&&this.generateStarOfDavidPath(this.radius,i),i.closePath(),i.clip(),i.clearRect(0,0,t.width,t.height),i.restore(),i.beginPath(),"rect"===this.cropMode?this.generateRectPath(this.radius,i):"circle"===this.cropMode?this.generateCirclePath(this.radius,i):"triangle"===this.cropMode?this.generateTrianglePath(this.radius,i):"star"===this.cropMode?this.generatePentagramPath(this.radius,i):"heart"===this.cropMode?this.generateHeartPath(this.radius,i):"hexagon"===this.cropMode?this.generateHexagonPath(this.radius,i):"starOfDavid"===this.cropMode&&this.generateStarOfDavidPath(this.radius,i),i.strokeStyle="green",i.lineWidth=2,i.closePath(),i.stroke()},zoomRatioAdd(){this.zoomRatio+=.01,this.zoomRatio=Number(this.zoomRatio.toFixed(2))},zoomRatioDec(){this.zoomRatio-=.01,this.zoomRatio=Number(this.zoomRatio.toFixed(2))},zooming(){let t=this.zoomRatio,i=this.imgWidth*t,e=this.imgHeight*t;this.backgroundSize=i>e?`auto ${e}px`:i+"px",this.backPosX<this.limitX&&(this.backPosX=this.limitX),this.backPosY<this.limitY&&(this.backPosY=this.limitY)},handleClose(){console.log("原始尺寸:",this.img.width,this.img.height),console.log("比例尺寸:",this.imgWidth,this.imgHeight),console.log("放缩尺寸：",this.imgWidth*this.zoomRatio,this.imgHeight*this.zoomRatio),this.zoomRatio=0},clipImg(){let t=this.imgWidth*this.zoomRatio,i=this.imgHeight*this.zoomRatio,e=document.createElement("canvas");e.width=this.cutBoxWidth,e.height=this.cutBoxHeight;let a=this.img.width,s=this.img.height;if(e.getContext){let o=e.getContext("2d");o.clearRect(0,0,this.cutBoxWidth,this.cutBoxHeight),o.beginPath(),"rect"===this.cropMode?this.generateRectPath(this.radius,o):"circle"===this.cropMode?this.generateCirclePath(this.radius,o):"triangle"===this.cropMode?this.generateTrianglePath(this.radius,o):"star"===this.cropMode?this.generatePentagramPath(this.radius,o):"heart"===this.cropMode?this.generateHeartPath(this.radius,o):"hexagon"===this.cropMode?this.generateHexagonPath(this.radius,o):"starOfDavid"===this.cropMode&&this.generateStarOfDavidPath(this.radius,o),o.clip(),o.drawImage(this.img,0,0,a,s,this.backPosX-this.marginX,this.backPosY-this.marginY,t,i)}this.base64=e.toDataURL("image/png",.8),console.log(this.base64),this.dialogVisible=!1},downloadClippedImage(){if(!this.base64)return void this.$message.warning("请先截取图片");const t=document.createElement("a");t.href=this.base64,t.download=`clipped_image_${(new Date).getTime()}.png`,document.body.appendChild(t),t.click(),document.body.removeChild(t),this.$message.success("图片下载成功")},changeCropMode(t){this.cropMode=t,this.shapMarge=[0,0,0,0],this.drawShapePath(),this.$nextTick(()=>{this.handleMoveX(0),this.handleMoveY(0)})},generateCirclePath(t,i){const e=t,a=t;i.arc(e,a,t,0,2*Math.PI),this.shapMarge=[0,0,0,0]},generateRectPath(t,i){const e=2*t,a=2*t;let s=[{x:0,y:0},{x:0,y:a},{x:e,y:a},{x:e,y:0}];this.ctxShapePath(s,i),this.calculateShapeMargins(s,t)},generateTrianglePath(t,i){const e=2*t,a=t,s=t,o=e,h=Math.sqrt(3)/2*o,r=h,c=s-r/2,n=c;let l=[{x:a,y:n},{x:a-o/2,y:n+h},{x:a+o/2,y:n+h}];this.ctxShapePath(l,i),this.calculateShapeMargins(l,t)},generatePentagramPath(t,i){const e=1.05*t,a=.382*e,s=t,o=1.05*t,h=.05*t;let r=[];for(let c=0;c<10;c++){const t=-Math.PI/2+c*Math.PI/5,i=c%2===0?e:a;r.push({x:s+i*Math.cos(t),y:o+i*Math.sin(t)+h})}this.ctxShapePath(r,i),this.calculateShapeMargins(r,t)},generateHeartPath(t,i){const e=t,a=t,s=1.4*t,o=.14444*t;i.moveTo(e,a-.25*s-o),i.bezierCurveTo(e+.5*s,a-s-o,e+1.3*s,a+.1*s-o,e,a+.7*s-o),i.bezierCurveTo(e-1.3*s,a+.1*s-o,e-.5*s,a-s-o,e,a-.25*s-o),this.shapMarge=[o,0,o,0]},generateHexagonPath(t,i){const e=t,a=t,s=t;let o=[];for(let h=0;h<6;h++){const t=-Math.PI/2+h*Math.PI/3;o.push({x:e+s*Math.cos(t),y:a+s*Math.sin(t)})}this.ctxShapePath(o,i),this.calculateShapeMargins(o,t)},generateStarOfDavidPath(t,i){const e=t,a=t,s=t;let o=[];for(let h=0;h<12;h++){const t=-Math.PI/2+h*Math.PI/6,i=h%2===0?s:s/2;o.push({x:e+i*Math.cos(t),y:a+i*Math.sin(t)})}this.ctxShapePath(o,i),this.calculateShapeMargins(o,t)},ctxShapePath(t,i){i.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e++)i.lineTo(t[e].x,t[e].y)},calculateShapeMargins(t,i){let e=1/0,a=-1/0,s=1/0,o=-1/0;for(const d of t)d.x<e&&(e=d.x),d.x>a&&(a=d.x),d.y<s&&(s=d.y),d.y>o&&(o=d.y);const h=2*i,r=2*i,c=s,n=h-a,l=r-o,g=e;this.shapMarge=[c,n,l,g]}}},h=o,r=(e("d8dd"),e("9a40")),c=Object(r["a"])(h,a,s,!1,null,"3c939b1f",null);i["default"]=c.exports},9904:function(t,i,e){},d8dd:function(t,i,e){"use strict";e("9904")}}]);